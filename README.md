# AllSky æ˜Ÿç©ºç›¸æœºç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹
AllSky æ˜¯ä¸€ä¸ªåŸºäº Python å’Œ OpenCV çš„å…¨æ™¯æ˜Ÿç©ºç›¸æœºç³»ç»Ÿï¼Œæ”¯æŒè‡ªåŠ¨æ•è·å¤œç©ºå›¾åƒï¼Œå¹¶åœ¨å›¾ç‰‡ä¸Šå åŠ è§‚æµ‹ç«™ä¿¡æ¯ã€æ—¶é—´ã€ç»çº¬åº¦ã€æ›å…‰ã€æ°”è±¡ã€ç½—ç›˜ã€LOGOã€æ˜Ÿä½“æ ‡æ³¨ç­‰ï¼Œç”Ÿæˆç¾è§‚çš„å…¨å¤©ç©ºè§‚æµ‹å›¾ç‰‡ã€‚é€‚ç”¨äºå¤©æ–‡å°ã€ç§‘æ™®ã€æ°”è±¡ç­‰åœºæ™¯ã€‚

## ğŸ†• æ”¹è¿›ç‰ˆæœ¬
é¡¹ç›®ç°åœ¨æä¾›äº†ä¸¤ä¸ªç‰ˆæœ¬ï¼š
- **`allsky.py`** - åŸå§‹ç‰ˆæœ¬ï¼ŒåŠŸèƒ½å®Œæ•´ä½†ä»£ç ç»“æ„è¾ƒç®€å•
- **`allsky_improved.py`** - æ”¹è¿›ç‰ˆæœ¬ï¼Œå…·æœ‰æ›´å¥½çš„æ¶æ„ã€é”™è¯¯å¤„ç†å’Œæ€§èƒ½

## ğŸ†• å®Œæ•´ç‰ˆæœ¬
é¡¹ç›®ç°åœ¨æä¾›äº†ä¸‰ä¸ªç‰ˆæœ¬ï¼š
- **`allsky.py`** - åŸå§‹ç‰ˆæœ¬ï¼ŒåŠŸèƒ½å®Œæ•´ä½†ä»£ç ç»“æ„è¾ƒç®€å•
- **`allsky_improved.py`** - æ”¹è¿›ç‰ˆæœ¬ï¼Œå…·æœ‰æ›´å¥½çš„æ¶æ„ã€é”™è¯¯å¤„ç†å’Œæ€§èƒ½
- **`allsky_complete.py`** - å®Œæ•´ç‰ˆæœ¬ï¼Œé›†æˆæ‰€æœ‰æ–°åŠŸèƒ½æ¨¡å—

### å®Œæ•´ç‰ˆæœ¬ç‰¹æ€§
- ğŸŒ¤ï¸ **çœŸå®å¤©æ°”æ•°æ®** - é›†æˆOpenWeatherMap APIï¼Œå®æ—¶è·å–æ°”è±¡ä¿¡æ¯
- â­ **å¤©æ–‡æ•°æ®è®¡ç®—** - çœŸå®çš„æ˜Ÿä½“ä½ç½®ã€è¡Œæ˜Ÿè½¨é“ã€æœˆç›¸ç­‰è®¡ç®—
- ğŸ“¸ **å›¾åƒå†å²ç®¡ç†** - è‡ªåŠ¨å­˜å‚¨ç­–ç•¥ã€å®šæ—¶æ‹æ‘„ã€æ‰¹å¤„ç†åŠŸèƒ½
- ğŸŒ **ç°ä»£åŒ–Webç•Œé¢** - å“åº”å¼è®¾è®¡ã€å®æ—¶é¢„è§ˆã€ç§»åŠ¨ç«¯æ”¯æŒ
- ğŸ“Š **å®Œæ•´ç›‘æ§ç³»ç»Ÿ** - ç³»ç»ŸçŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡ã€é”™è¯¯ç»Ÿè®¡
- ğŸ”§ **é«˜çº§é…ç½®ç®¡ç†** - çƒ­æ›´æ–°ã€éªŒè¯ã€å¤‡ä»½æ¢å¤

## ä¸»è¦åŠŸèƒ½
- è‡ªåŠ¨æ ¹æ®æ˜¼å¤œåˆ‡æ¢æ›å…‰å‚æ•°ï¼Œæ•è·å…¨æ™¯æ˜Ÿç©ºå›¾ç‰‡
- å›¾ç‰‡è‡ªåŠ¨å åŠ ï¼š
  - è§‚æµ‹ç«™åã€ç»çº¬åº¦ã€æ—¶é—´ã€æ—¥å‡ºæ—¥è½ã€æ›å…‰
  - ç½—ç›˜ï¼ˆN/E/S/Wï¼Œæ”¯æŒå¤–éƒ¨æ–¹å‘æ•°æ®ï¼‰
  - æ°”è±¡æ•°æ®ï¼ˆæ”¯æŒå¤–éƒ¨æ¥å£ï¼Œé»˜è®¤N/Aï¼‰
  - LOGOï¼ˆå¯è‡ªå®šä¹‰ï¼‰
  - æ˜Ÿä½“æ ‡æ³¨ï¼ˆæ”¯æŒæ‰©å±•çœŸå®æ˜Ÿè¡¨ï¼‰
- æ”¯æŒé€šè¿‡ HTTP æ¥å£è¿œç¨‹æ§åˆ¶å’Œé…ç½®å‚æ•°

## ä¸»è¦æ¥å£
- `GET /capture_image`ï¼šæ•è·ä¸€å¼ å›¾ç‰‡å¹¶è¿”å›ï¼Œå›¾ç‰‡å¸¦å…¨éƒ¨å åŠ ä¿¡æ¯
- `POST /apply_settings`ï¼šè®¾ç½®ä¸åŒå¤©å…‰é˜¶æ®µçš„æ›å…‰/å¢ç›Šå‚æ•°
- `POST /set_station_info`ï¼šè®¾ç½®è§‚æµ‹ç«™åå’Œç»çº¬åº¦
- `GET /get_station_info`ï¼šæŸ¥è¯¢å½“å‰è§‚æµ‹ç«™å‚æ•°

## è¿è¡Œæ–¹æ³•

### å¿«é€Ÿå¼€å§‹
1. å®‰è£…ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```
   ä¸»è¦ä¾èµ–ï¼šopencv-python, flask, astral, numpy

2. å¯åŠ¨æœåŠ¡ï¼š
   ```bash
   # ä½¿ç”¨å®Œæ•´ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
   python allsky_complete.py
   
   # æˆ–ä½¿ç”¨æ”¹è¿›ç‰ˆæœ¬
   python allsky_improved.py
   
   # æˆ–ä½¿ç”¨åŸå§‹ç‰ˆæœ¬
   python allsky.py
   ```

3. è®¿é—®æ¥å£ï¼š
   - å›¾åƒæ•è·ï¼š`http://localhost:5000/capture_image`
   - å¥åº·æ£€æŸ¥ï¼š`http://localhost:5000/health`
   - å‰ç«¯é¡µé¢ï¼š`http://localhost:5000/allsky.html`

### é…ç½®è¯´æ˜
æ”¹è¿›ç‰ˆæ”¯æŒé€šè¿‡ `config.json` è¿›è¡Œé…ç½®ï¼š

```json
{
  "camera": {
    "index": 0,  // ç›¸æœºç´¢å¼•
    "default_settings": {
      "day": {"exposure": -5, "gain": 10},
      "night": {"exposure": 5, "gain": 40}
    }
  },
  "station": {
    "name": "Your Observatory",
    "latitude": 40.7128,
    "longitude": -74.0060
  },
  "server": {
    "host": "0.0.0.0",
    "port": 5000
  }
}
```

## ç›®å½•ç»“æ„
### ä¸»ç¨‹åºæ–‡ä»¶
- `allsky.py`                åŸå§‹ä¸»ç¨‹åºï¼ŒFlaskæ¥å£ä¸å›¾åƒå¤„ç†
- `allsky_improved.py`       æ”¹è¿›ç‰ˆä¸»ç¨‹åºï¼Œå…·æœ‰æ›´å¥½çš„æ¶æ„å’Œé”™è¯¯å¤„ç†
- `allsky_complete.py`       å®Œæ•´ç‰ˆä¸»ç¨‹åºï¼Œé›†æˆæ‰€æœ‰æ–°åŠŸèƒ½æ¨¡å—

### åŠŸèƒ½æ¨¡å—
- `config_manager.py`        é…ç½®ç®¡ç†æ¨¡å—
- `logger_manager.py`        æ—¥å¿—ç®¡ç†æ¨¡å—
- `exceptions.py`            å¼‚å¸¸å¤„ç†æ¨¡å—
- `weather_manager.py`       å¤©æ°”APIç®¡ç†æ¨¡å—
- `astronomy_manager.py`     å¤©æ–‡æ•°æ®ç®¡ç†æ¨¡å—
- `image_manager.py`         å›¾åƒå†å²ç®¡ç†æ¨¡å—

### é…ç½®å’Œæ–‡æ¡£
- `config.json`              é…ç½®æ–‡ä»¶ï¼ˆæ”¹è¿›ç‰ˆä½¿ç”¨ï¼‰
- `requirements.txt`         Pythonä¾èµ–åŒ…åˆ—è¡¨
- `IMPROVEMENTS.md`          è¯¦ç»†æ”¹è¿›è¯´æ˜æ–‡æ¡£
- `README.md`                é¡¹ç›®è¯´æ˜æ–‡æ¡£

### Webç•Œé¢
- `allsky.html`              ç®€å•å‰ç«¯é¡µé¢
- `camera_settings.html`     æ‘„åƒå¤´å‚æ•°è®¾ç½®é¡µé¢
- `dashboard.html`           ç°ä»£åŒ–æ§åˆ¶é¢æ¿ï¼ˆå®Œæ•´ç‰ˆä½¿ç”¨ï¼‰

### èµ„æºæ–‡ä»¶
- `WechatIMG38126.jpg`       é»˜è®¤LOGOå›¾ç‰‡

## æ‰©å±•å»ºè®®
- å¯¹æ¥çœŸå®æ°”è±¡/ç½—ç›˜/æ˜Ÿè¡¨æ•°æ®
- å¢åŠ å®šæ—¶è‡ªåŠ¨æ‹æ‘„ã€å†å²å›¾ç‰‡ç®¡ç†ç­‰åŠŸèƒ½
- ç¾åŒ–å‰ç«¯é¡µé¢ï¼Œæ”¯æŒè¿œç¨‹å®æ—¶é¢„è§ˆ

---

> å¼€æºåœ°å€ï¼šhttps://github.com/rockets-cn/allsky 